---
tags: [Book/Unit Testing]
title: 단위 테스트 스타일
created: '2022-03-24T03:34:13.340Z'
modified: '2022-03-24T05:03:01.481Z'
---

# 단위 테스트 스타일

## 단위 테스트의 세 가지 스타일

단위 테스트에는 세 가지 스타일이 있고, 하나의 테스트에서 여러 스타일을 사용할 수 있다.

- 출력 기반 테스트: 함수형이라고도 한다. 부작용이 없고 출력만 검증하는 특징을 가진다.
- 상태 기반 테스트: 작업이 완료된 후 시스템 상태를 확인한다. 여기에서 상태는 데이터베이스나 파일 시스템 등 프로세스 외부 의존성의 상태를 의미한다.
- 통신 기반 테스트: 이 테스트는 목을 사용해 테스트 대상 시스템과 협력자 간 통신을 검증한다.

> 고전파는 통신 기반 스타일보다 상태 기반 스타일을 선호한다.

## 단위 테스트 스타일 비교

좋은 단위 테스트의 4대 요소는 다음과 같다.
- 회귀 방지
- 리팩터링 내성
- 빠른 피드백
- 유지 보수성

### 회귀 방지와 피드백 속도 지표로 테스트 스타일 비교

회귀 방지는 테스트 중에 실행되는 코드의 양과 코드 복잡도, 도메인 유의성에 따라 결정된다.
다른 테스트 스타일은 코드의 양에 큰 차이가 없지만, 통신 기반 스타일을 남용한다면 너무 작은 코드 조각을 검증하려 다른 것은 모두 목을 사용하게 되는 등 피상적인 테스트가 될 수 있다.

테스트 스타일과 테스트 피드백 속도에도 큰 상관관계가 없지만, 목은 런타임 수행 시 지연 시간이 생기는 편이므로 통신 기반 테스트에서 조금 느려질 수 있다. (테스트가 수만 개 수준이 아니라면 큰 차이는 없다.)

### 리팩터링 내성 지표로 테스트 스타일 비교

리팩터링 내성은 리팩터링 중에 발생하는 거짓 양성에 대한 척도이다.

출력 기반 테스트는 테스트가 테스트 대상 메서드에만 결합되므로 거짓 양성 방지가 될 가능성이 거의 없다.
상태 기반 테스트는 테스트 대상 메서드 외에도 클래스 상태와 함께 작동하기 때문에 구현 세부 사항에 테스트가 얽매일 가능성이 높아진다.
통신 기반 테스트는 태스트 대역으로 상호 작용을 확인하므로 허위 경보에 가장 취약하다. 따라서 리팩터링 내성을 지키려면 통신 기반 테스트를 주의 깊게 사용해야 한다.

> 리팩터링에 안정적이지 않은 특성이 통신 기반 테스트의 결정적인 특징인 것은 아니다. 캡슐화를 잘 지키고 테스트를 쉽게 식별할 수 있도록 한다면 거짓 양성을 줄일 수 있다.

### 유지 보수성 지표로 테스트 스타일 비교

유지 보수성 지표는 단위 테스트 스타일에 따라 크게 달라지지만, 리팩터링 내성과 달리 완화할 수 있는 방법이 많지 않다. 
- 테스트가 크면, 파악도 변경도 어려우므로 유지 보수가 어렵다.
- 하나 이상의 외부 의존성이 있다면, 운영에 시간이 필요하므로 유지 보수가 어렵다.

다른 테스트 스타일과 비교한다면, 짧고 간결한 출력 기반 테스트가 가장 유지 보수하기 쉽다. 출력 기반 테스트의 코드는 전역 상태나 내부 상태를 변경하지 않는다.

상태 기반 테스트는 출력 기반 테스트보다 코드의 양이 많고 많은 경우의 수를 검증해야 한다. 코드를 숨겨서 테스트를 단축히키는 헬퍼 메서드로 문제를 완화할 수 있지만, 헬퍼 메서드가 재사용되지 않는 한 굳이 따로 관리하는 데에 이점이 없다. 혹은 동등 멤버를 정의해서 값 객체로 테스트 결과를 검증할 수 있지만 클래스가 값에 해당하고, 값 객체로 변환할 수 있을 때만 사용할 수 있다. 그 외에는 코드 오염으로 이어질 우려가 있다.

통신 기반 테스트는 테스트 대역과 상호 작용 검증을 설정해야 하고, 목이 체이닝되어 있을 때 테스트가 더 커지며 유지보수하기 어려워진다.

## 함수형 아키텍처 이해

### 함수형 프로그래밍이란?
함수형 프로그래밍은 수학적 함수를 사용한 프로그래밍이고 숨은 입출력이 없으며 호출 횟수에 상관없이 주어진 입력에 대해 동일한 출력을 생성한다. 

특히 입출력을 명시한 함수는 테스트가 짧고 간결해서 이해하거나 유지 보수하기 쉬우므로 테스트하기 적합하다. 반면 숨은 입출력을 가진 함수는 부작용, 예외, 내외부 상태에 대한 참조를 가져 적합하지 않은 함수형 형태이다.

### 함수형 아키텍처란?
함수형 프로그래밍의 목적은 부작용을 완전히 제거하는 것이 아니라, 비즈니스 로직을 처리하는 코드와 부작용을 일으키는 코드를 분리하는 것이다. 코드를 작성할 때 **결정을 내리는 코드와 해당 결정에 따라 작용하는 코드를 분리**해서 함수형 코어, 가변 셸로서 본다. 

## 함수형 아키텍처와 출력 기반 테스트로의 전환
함수형 아키텍처로 리팩토링하려면, 우선 프로세스 외부 의존성을 목으로 변경하고 목에서 함수형 아키텍처로 변경해야 한다.

## 함수형 아키텍처의 단점 이해하기
코드 베이스카 커지고 성능을 고려하면 항상 함수형 아키텍처가 좋은 것은 아니다. 함수형 아키텍쳐와 관련된 비용와 장단점을 살펴보자.

### 함수형 아키텍처 적용 가능성
종종 실행 흐름이 간단하지 않을 때, 즉 의사 결정 중간 결과에 따라 프로세스 외부 의존성과의 통신이 필요할 때는 함수형 아키텍처가 적합하지 않을 수 있다. 이럴 경우에는 시스템의 복잡도와 중요성을 고려해야 한다. 코드베이스가 단순하거나 그렇게 중요하지 않으면, 굳이 함수형 아키텍처로 구성할 필요가 없다. 

### 코드베이스의 크기 증가
함수형 아키텍처와 전통적인 아키텍처 사이 선택은 성능과 코드 유지보수성 사이의 절충이다. 함수형 아키텍처는 유지 보수성 향상을 위해 성능을 희생한다.
