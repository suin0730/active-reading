---
tags: [Book/Unit Testing]
title: 좋은 단위 테스트의 4대 요소
created: '2022-04-07T02:39:42.335Z'
modified: '2022-04-07T04:57:35.959Z'
---

# 4. 좋은 단위 테스트의 4대 요소

## 4.1 좋은 단위 테스트의 4대 요소 자세히 살펴보기

좋은 단위 테스트 스위트의 특성은 다음과 같다.
- 실제로 사용되는 테스트가 가치 있는 것이므로 개발 주기에 통합되어 있다.
- 코드에서 가장 중요한 부분만을 테스트 대상으로 한다.
- 최소한의 유지비로 최대한의 가치를 끌어낸다.

좋은 단위 테스트 스위트를 달성하려면 어떤 것이 가치있는 테스트인지 알 수 있어야 한다. 가치 있는 테스트는 회귀를 방지해야 하고, 리팩토링 내성이 강해야 하며 빠른 피드백 하에 이뤄져야 하고 유지보수성이 높아야 한다.

### 4.1.1 회귀 방지

회귀 방지는 코드를 수정한 후 기능이 의도한 대로 작동하지 않는 것이다. 일반적으로 실행되는 코드가 많을수록 테스트에서 회귀가 나타날 가능성이 높기때문에 복잡한 코드를 테스트하는 것이 가치있다. 단순한 코드를 테스트하는 것은 가치가 거의 없다.

### 4.1.2 리팩터링 내성

리팩터링 내성은 테스트를 실패하게 하지 않고 어플리케이션 코드를 리팩터링할 수 있는지에 대한 척도이다. 코드를 리팩터링했을때 기능은 완벽하게 동작하나 테스트가 실패한다면 그것은 거짓 양성이다. 거짓 양성이 많이 나타날수록 테스트 스위트에는 악영향을 미친다. 테스트는 기능이 올바르게 동작하지 않는 것에 대한 경고를 보내야 하는데, 거짓 양성은 프로그래머가 코드 문제에 대응할 의지를 상실하게 한다. 또한 거짓 양성을 피하기 위해 리팩터링을 최소한으로 하게 되어 코드의 가독성이 낮아지고 복잡도가 높아진다.

### 4.1.3 거짓 양성의 원인

거짓 양성은 테스트와 테스트 대상 시스템(SUT)이 많이 결합할수록 더 많이 발생한다. 거짓 양성이 발생할 가능성을 줄이려면 세부적인 구현에서 테스트를 분리해야 한다. 일반적으로 거짓 양성을 발생하게 하는 테스트는 일반적으로 사용될 수 있는 로직을 고려하지 않고 특정 로직에서만 동작하도록 코드를 구현해두었다.

### 4.1.4 구현 세부 사항 대신 최종 결과를 목표로 하기

테스트를 깨지지 않게 하고 리팩터링 내성을 높이려면 SUT와 테스트 간 결합도를 낮추어야 하고, 이런 테스트들은 공통적으로 구현을 블랙박스로 취급한다. 이러한 방식으로 테스트는 최종 사용자에게 의미 있는 결과를 검증해야 한다.

## 4.2 회귀 방지와 리팩터링 내성의 관계

좋은 단위 테스트를 구성하는 요소 중 회귀 방지와 리팩터링 내성은 시간이 흐르면서 프로젝트에 다르게 영향을 미친다. 프로젝트가 시작된 직후에는 회귀 방지를 만족시키는 것이 중요하지만, 후반에는 리팩터링 내성이 중요하게 다뤄져야 한다.

- 거짓 음성: 기능이 올바르게 동작하지 않으나 테스트는 성공하는 경우 (회귀 방지)
- 거짓 양성: 기능은 올바르게 동작하나 테스트는 실패하는 경우 (리팩터링 내성)

단기적으로는 거짓 양성이 거짓 음성만큼 나쁘지 않다. 실제 버그가 운영 코드에 들어가는 것보다는 잘못된 경고를 받는 것이 낫기 때문이다. 그러나 프로젝트가 성장함에 따라 거짓 양성이 테스트 스위트에 큰 영향을 미치게 된다.

## 4.3 빠른 피드백과 유지 보수성

좋은 단위 테스트를 구성하는 요소 중 빠른 피드백과 유지보수성을 살펴보자. 테스트가 빠르게 실행된다면 코드에 결함이 생기고서 고쳐질 때까지의 피드백 루프를 줄여서, 버그를 수정하는 데 드는 비용을 크게 줄일 수 있다. 오래 걸리는 피드백은 코드가 잘못된 방향으로 갈 가능성을 높인다. 좋은 단위 테스트의 마지막 틍성인 유지 보수성은 테스트가 얼마나 이해하기 어려운지, 얼마나 실행하기 어려운지로 확인할 수 있다.

## 4.4 이상적인 테스트란?

테스트의 가치는 좋은 단위 테스트의 4대 특성은 곱해서 결정된다. 이상적인 테스트는 모든 지표가 1이라 결과가 1로 나오는 경우일 것이다. 그러나 처음 세 가지 특성인 회귀 방지, 리팩터링 내성, 빠른 피드백은 상호 배타적이기 때문에 셋 중 하나를 희생해야 나머지 둘을 최대로 할 수 있다.

- 엔드 투 엔드 테스트: 회귀 방지와 리팩터링 내성이 우수하나, 속도가 느려 피드백을 빠르게 받지 못한다.
- 간단한 테스트: 테스트가 매우 빠르게 실행되고 리팩터링 내성이 뛰어나지만 회귀 방지가 없다.
- 깨지기 쉬운 테스트: 실행이 빠르고 회귀를 잡을 가능성이 높지만 거짓 양성이 높은 테스트는 리팩터링을 견디지 못할 것이다.

리팩터링 내성은 이진 값이다. 즉, 테스트는 리팩터링 내성을 가지거나 가지지 않기 때문에 리팩터링 내성을 포기하면 테스트의 퀄리티는 매우 낮아질 것이다. 따라서 회귀 방지와 빠른 피드백을 조절하며 개발하는 시스템에 알맞게 절충시키는 것이 해답이다. 

## 4.5 대중적인 테스트 자동화 개념

### 테스트 피라미드

테스트 피라미드는 테스트 유형 간 일정한 비율을 일컫는 개념이다. 단위 테스트, 통합 테스트, 엔드 투 엔드 테스트를 피라미드에 두고 각 층이 넓을 수록 해당 테스트가 보편적이라는 것을 의미한다.

### 블랙박스 테스트와 화이트박스 테스트

- 블랙박스 테스트: 시스템의 내부 구조를 몰라도 시스템 기능을 검사할 수 있는 방법으로 일반적으로 어플리케이션이 어떻게 동작하는지가 아닌, 무엇을 해야 하는지를 중심으로 구축된다.
- 화이트박스 테스트: 애플리케이션의 내부 작업을 검증하는 방법으로, 요구 사항이 아닌 소스 코드에서 파생된다.

